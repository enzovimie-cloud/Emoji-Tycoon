<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Emoji Tycoon HACKER ED.</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üî•</text></svg>">
    
    <style>
        /* ESTILO GENERAL */
        :root { --bg: #1a1a2e; --panel: #16213e; --accent: #e94560; --gold: #ffd700; --text: #fff; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; height: 100vh; overflow: hidden; display: flex; flex-direction: column; user-select: none; }
        
        /* HEADER */
        .header { background: rgba(0,0,0,0.8); padding: 15px; display: flex; justify-content: space-between; border-bottom: 2px solid var(--accent); z-index: 10; backdrop-filter: blur(5px); }
        .money { color: #2ecc71; font-weight: 800; font-size: 1.2rem; text-shadow: 0 0 5px #2ecc71; }
        .gems { color: var(--gold); font-weight: bold; }
        
        /* ZONA DE JUEGO */
        .game-zone { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; background: radial-gradient(circle, #1f4068 0%, #1a1a2e 80%); }
        #main-emoji { font-size: 6rem; cursor: pointer; transition: transform 0.05s; filter: drop-shadow(0 0 20px var(--accent)); -webkit-tap-highlight-color: transparent; }
        #main-emoji:active { transform: scale(0.9); }

        /* MODALES */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 999; display: none; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        .modal-content { background: var(--panel); padding: 25px; border-radius: 20px; border: 2px solid var(--gold); max-width: 85%; width: 300px; box-shadow: 0 0 50px rgba(0,0,0,0.8); }
        .hacker-mode { border-color: #ff0000; box-shadow: 0 0 50px #ff0000; animation: shake 0.5s infinite; }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 20% { transform: translate(-3px, 0px) rotate(1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 40% { transform: translate(1px, -1px) rotate(1deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } 60% { transform: translate(-3px, 1px) rotate(0deg); } 70% { transform: translate(3px, 1px) rotate(-1deg); } 80% { transform: translate(-1px, -1px) rotate(1deg); } 90% { transform: translate(1px, 2px) rotate(0deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }

        /* BOTONES */
        .btn { padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-weight: bold; width: 100%; cursor: pointer; font-size: 1rem; }
        .btn-green { background: #2ecc71; color: #000; }
        .btn-gold { background: linear-gradient(45deg, #f1c40f, #e67e22); color: #000; animation: pulse 1.5s infinite; }
        .btn-red { background: #e74c3c; color: white; }
        .btn:disabled { background: #555; color: #888; animation: none; }

        /* TABS */
        .tabs { display: flex; background: #0f3460; }
        .tab { flex: 1; padding: 15px; background: none; border: none; color: #aaa; font-weight: bold; border-top: 3px solid transparent; }
        .tab.active { color: white; background: var(--panel); border-top-color: var(--accent); }
        .panel-container { height: 45%; background: var(--panel); overflow-y: auto; padding-bottom: 20px; }
        .panel { display: none; padding: 15px; }
        .panel.active { display: block; }

        /* ITEMS */
        .item { background: rgba(255,255,255,0.05); padding: 10px; margin-bottom: 8px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .particle { position: absolute; color: #2ecc71; font-weight: bold; pointer-events: none; animation: floatUp 0.8s forwards; }
        @keyframes floatUp { to { transform: translateY(-100px); opacity: 0; } }
    </style>
</head>
<body>

    <div id="hacker-modal" class="modal-overlay">
        <div class="modal-content hacker-mode">
            <h1 style="color:red; margin:0;">‚ö†Ô∏è ALERTA ‚ö†Ô∏è</h1>
            <p>¬°UN HACKER INTENTA ROBAR TUS FONDOS!</p>
            <p style="font-size:0.8rem;">Elige r√°pido:</p>
            <button class="btn btn-green" onclick="resolveHacker(true)">üõ°Ô∏è BLOQUEAR (Ver Anuncio)<br><small>¬°Salvas tu dinero y ganas Bonus!</small></button>
            <button class="btn btn-red" onclick="resolveHacker(false)">‚ùå NO HACER NADA<br><small>Pierdes 20% de dinero</small></button>
        </div>
    </div>

    <div id="offline-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 style="color:var(--gold)">¬°BIENVENIDO!</h2>
            <p>Ganaste esto mientras dorm√≠as:</p>
            <h1 id="offline-amount" style="color:#2ecc71">$0</h1>
            <button class="btn btn-gold" onclick="claimOffline(true)">üì∫ RECLAMAR DOBLE</button>
            <button class="btn btn-green" onclick="claimOffline(false)">Reclamar Normal</button>
        </div>
    </div>

    <div class="header">
        <div><strong>EMOJI CORP</strong> <small>Nvl <span id="lvl-num">1</span></small></div>
        <div style="text-align:right;">
            <div class="money" id="money-ui">$0</div>
            <div class="gems" id="gems-ui">üíé 0</div>
        </div>
    </div>

    <div class="game-zone">
        <div id="main-emoji" onclick="doClick(event)">üí∏</div>
        <div style="position: absolute; bottom: 5px; font-size: 0.7rem; color: #555;"> <script>
  atOptions = {
    'key' : '92cf9b7506a2347b830d7ec0e9445744',
    'format' : 'iframe',
    'height' : 50,
    'width' : 320,
    'params' : {}
  };
</script>
<script src="https://www.highperformanceformat.com/92cf9b7506a2347b830d7ec0e9445744/invoke.js"></script></div>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="tab('prod')">üè≠ M√°quinas</button>
        <button class="tab" onclick="tab('upgrades')">‚ö° Mejoras</button>
        <button class="tab" onclick="tab('shop')">üíé Tienda</button>
    </div>

    <div class="panel-container">
        <div id="prod" class="panel active"></div>
        <div id="upgrades" class="panel"></div>
        <div id="shop" class="panel">
            <div style="text-align:center; padding:10px; border:1px dashed white; margin-bottom:15px; border-radius:10px;">
                <div style="font-size:2rem;">üéÅ</div>
                <h3>CAJA MISTERIOSA</h3>
                <button class="btn btn-gold" onclick="openMysteryBox()">ABRIR (15 üíé)</button>
            </div>
            <button class="btn btn-green" onclick="watchAdForGems()">üé¨ CONSEGUIR 10 üíé GRATIS</button>
            <button class="btn btn-green" style="background:#3498db; color:white; margin-top:20px;" onclick="buyTimeWarp()">‚è≥ SALTO TEMPORAL (30 üíé)</button>
        </div>
    </div>

<script>
    // --- CONFIGURACI√ìN ---
    const machinesDB = [
        {name: "Becario", cost: 15, prod: 1, icon: "ü§ì"},
        {name: "Servidor", cost: 100, prod: 5, icon: "üñ•Ô∏è"},
        {name: "Crypto Miner", cost: 1100, prod: 45, icon: "‚õèÔ∏è"},
        {name: "Botnet", cost: 12000, prod: 350, icon: "ü§ñ"},
        {name: "IA Cu√°ntica", cost: 150000, prod: 2500, icon: "üß†"}
    ];
    const upgradesDB = [
        {name: "Rat√≥n Gamer", cost: 500, mult: 2, icon: "üñ±Ô∏è", desc: "Clic x2"},
        {name: "Bebida Energ√©tica", cost: 2500, mult: 2, icon: "ü•§", desc: "M√°quinas x2"},
        {name: "Overclocking", cost: 10000, mult: 5, icon: "‚ö°", desc: "Clic x5"},
        {name: "Refrigeraci√≥n L√≠quida", cost: 500000, mult: 5, icon: "‚ùÑÔ∏è", desc: "M√°quinas x5"}
    ];

    // --- ESTADO (CORREGIDO PARA EVITAR ERRORES) ---
    // He cambiado el nombre del guardado a 'EmojiHacker_v2' para reiniciar tus datos corruptos
    let game = { money: 0, gems: 5, qtys: [0,0,0,0,0], upgrades: [], lastSave: Date.now(), prestige: 1, total: 0 };
    
    // Carga segura
    if(localStorage.getItem('EmojiHacker_v2')) {
        try {
            let savedGame = JSON.parse(localStorage.getItem('EmojiHacker_v2'));
            // Verificar integridad
            if(savedGame.qtys && savedGame.qtys.length === machinesDB.length) {
                game = savedGame;
                setTimeout(checkOffline, 1000);
            }
        } catch(e) {
            console.log("Error cargando partida, reiniciando...");
        }
    }

    // --- L√ìGICA ---
    function save() { 
        game.lastSave = Date.now(); 
        localStorage.setItem('EmojiHacker_v2', JSON.stringify(game)); 
    }
    
    function getPPS() {
        let p = 0;
        machinesDB.forEach((m, i) => {
            // Protecci√≥n contra errores si la partida vieja falla
            if(game.qtys[i] !== undefined) {
                p += (m.prod * game.qtys[i]);
            }
        });
        if(game.upgrades.includes(1)) p *= 2;
        if(game.upgrades.includes(3)) p *= 5;
        return p * game.prestige;
    }

    setInterval(() => {
        const inc = getPPS() / 10;
        if(inc > 0) { game.money += inc; game.total += inc; }
        document.getElementById('money-ui').innerText = `$${Math.floor(game.money).toLocaleString()}`;
        document.getElementById('lvl-num').innerText = Math.floor(Math.log10(game.total + 1)) + 1;
        save();
        
        // POSIBILIDAD DE HACKER (1% cada segundo si tienes dinero)
        if(Math.random() < 0.01 && game.money > 1000 && document.getElementById('hacker-modal').style.display !== 'flex') {
            triggerHacker();
        }
    }, 100);

    // --- EVENTOS ---
    function triggerHacker() {
        document.getElementById('hacker-modal').style.display = 'flex';
        if(navigator.vibrate) navigator.vibrate([200, 100, 200]);
    }

    function resolveHacker(watchedAd) {
        if(watchedAd) {
            showAd(() => {
                const bonus = game.money * 0.25; 
                game.money += bonus;
                alert(`¬°HACKER BLOQUEADO! Ganaste $${Math.floor(bonus)}`);
                document.getElementById('hacker-modal').style.display = 'none';
            });
        } else {
            const loss = game.money * 0.20; 
            game.money -= loss;
            alert(`¬°TE HAN HACKEADO! Perdiste $${Math.floor(loss)}`);
            document.getElementById('hacker-modal').style.display = 'none';
        }
    }

    // --- OFFLINE ---
    let offlineCash = 0;
    function checkOffline() {
        const sec = (Date.now() - game.lastSave) / 1000;
        if(sec > 60 && getPPS() > 0) {
            offlineCash = getPPS() * sec;
            document.getElementById('offline-amount').innerText = `$${Math.floor(offlineCash).toLocaleString()}`;
            document.getElementById('offline-modal').style.display = 'flex';
        }
    }
    function claimOffline(double) {
        if(double) showAd(() => { game.money += offlineCash * 2; document.getElementById('offline-modal').style.display = 'none'; });
        else { game.money += offlineCash; document.getElementById('offline-modal').style.display = 'none'; }
    }

    // --- COMPRAS ---
    function buyItem(i) {
        const cost = Math.floor(machinesDB[i].cost * Math.pow(1.15, game.qtys[i]));
        if(game.money >= cost) { game.money -= cost; game.qtys[i]++; render(); }
    }
    function buyUpgrade(i) {
        if(game.money >= upgradesDB[i].cost && !game.upgrades.includes(i)) {
            game.money -= upgradesDB[i].cost; game.upgrades.push(i); render();
        }
    }
    function openMysteryBox() {
        if(game.gems >= 15) {
            game.gems -= 15;
            const r = Math.random();
            if(r < 0.5) { const p = getPPS()*300; game.money+=p; alert(` Ganaste $${Math.floor(p)}`); }
            else if(r < 0.9) { game.gems+=20; alert(`¬°20 Gemas!`); }
            else { game.prestige+=0.5; alert(`¬°PREMIO GORDO! Multiplicador +0.5x`); }
            render();
        } else alert("Faltan gemas");
    }
    function watchAdForGems() { showAd(() => { game.gems += 10; render(); alert("+10 Gemas"); }); }
    function buyTimeWarp() { if(game.gems >= 30) { game.gems-=30; game.money+=getPPS()*3600; render(); } }
    
    function doClick(e) {
        let clickVal = (1 + (getPPS() * 0.05)) * game.prestige;
        if(game.upgrades.includes(0)) clickVal *= 2;
        if(game.upgrades.includes(2)) clickVal *= 5;
        game.money += clickVal; game.total += clickVal;
        
        const p = document.createElement('div'); p.innerText=`+$${Math.floor(clickVal)}`; p.className='particle';
        p.style.left=e.clientX+'px'; p.style.top=(e.clientY-40)+'px'; document.body.appendChild(p); setTimeout(()=>p.remove(),800);
        document.getElementById('money-ui').innerText = `$${Math.floor(game.money).toLocaleString()}`;
    }

    // --- UI ---
    function tab(id) {
        document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        event.target.classList.add('active');
    }
    function render() {
        document.getElementById('gems-ui').innerText = `üíé ${game.gems}`;
        // Render M√°quinas
        const d1 = document.getElementById('prod'); d1.innerHTML = "";
        machinesDB.forEach((m, i) => {
            const cost = Math.floor(m.cost * Math.pow(1.15, game.qtys[i]));
            d1.innerHTML += `<div class="item"><div><span style="font-size:1.5rem">${m.icon}</span> <b>${m.name}</b> (${game.qtys[i]})<br><small>+$${m.prod}/s</small></div><button class="btn-green" style="width:auto; padding:5px 15px;" onclick="buyItem(${i})" ${game.money<cost?'disabled':''}>$${cost.toLocaleString()}</button></div>`;
        });
        // Render Mejoras
        const d2 = document.getElementById('upgrades'); d2.innerHTML = "";
        upgradesDB.forEach((u, i) => {
            if(!game.upgrades.includes(i)) {
                d2.innerHTML += `<div class="item"><div><span style="font-size:1.5rem">${u.icon}</span> <b>${u.name}</b><br><small>${u.desc}</small></div><button class="btn-green" style="width:auto; padding:5px 15px;" onclick="buyUpgrade(${i})" ${game.money<u.cost?'disabled':''}>$${u.cost.toLocaleString()}</button></div>`;
            }
        });
        if(d2.innerHTML=="") d2.innerHTML="<center>¬°Todo mejorado!</center>";
    }
    render();

    // ‚ñº‚ñº‚ñº TU ENLACE YA EST√Å PUESTO AQU√ç ‚ñº‚ñº‚ñº
    window.lastAdTime = 0;
    
    function showAd(callback) {
        // Enlace actualizado que me has pasado
        const adLink = "https://www.effectivegatecpm.com/ttwcdab5?key=8d51779f7c6cbf2f752d275eb491f8dc";
        
        if(Date.now() - window.lastAdTime < 15000) { alert("Anuncio cargando... espera"); return; }
        window.open(adLink, '_blank');
        window.lastAdTime = Date.now();
        setTimeout(() => { if(callback) callback(); }, 1500);
    }
</script>
</body>
</html>
